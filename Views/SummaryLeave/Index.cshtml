@model WebENG.Models.UserModel;
@{
    ViewData["Title"] = "Leave Summary";
}
<link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

<style>

    .custom-control-input:not(:checked) ~ .custom-control-label::before {
        background-color: lightgray;
        border-color: lightgray;
    }

    .custom-control-input:checked ~ .custom-control-label::before {
        background-color: green;
        border-color: green;
    }

    .kanit-thin {
        font-family: "Kanit", sans-serif !important;
        font-weight: 100 !important;
        font-style: normal !important;
    }

    .kanit-extralight {
        font-family: "Kanit", sans-serif;
        font-weight: 200;
        font-style: normal;
    }

    .kanit-light {
        font-family: "Kanit", sans-serif !important;
        font-weight: 300 !important;
        font-style: normal !important;
    }

    .kanit-regular {
        font-family: "Kanit", sans-serif;
        font-weight: 400;
        font-style: normal;
    }

    .kanit-medium {
        font-family: "Kanit", sans-serif;
        font-weight: 500;
        font-style: normal;
    }

    .kanit-semibold {
        font-family: "Kanit", sans-serif;
        font-weight: 600;
        font-style: normal;
    }

    .kanit-bold {
        font-family: "Kanit", sans-serif;
        font-weight: 700;
        font-style: normal;
    }

    .kanit-extrabold {
        font-family: "Kanit", sans-serif;
        font-weight: 800;
        font-style: normal;
    }

    .kanit-black {
        font-family: "Kanit", sans-serif;
        font-weight: 900;
        font-style: normal;
    }

    .kanit-thin-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 100;
        font-style: italic;
    }

    .kanit-extralight-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 200;
        font-style: italic;
    }

    .kanit-light-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 300;
        font-style: italic;
    }

    .kanit-regular-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 400;
        font-style: italic;
    }

    .kanit-medium-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 500;
        font-style: italic;
    }

    .kanit-semibold-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 600;
        font-style: italic;
    }

    .kanit-bold-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 700;
        font-style: italic;
    }

    .kanit-extrabold-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 800;
        font-style: italic;
    }

    .kanit-black-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 900;
        font-style: italic;
    }

    /* สไตล์สำหรับ input */
    input[type="text"] {
        transition: opacity 0.3s ease, background-color 0.3s ease; /* แอนิเมชันนุ่มนวล */
    }
        /* input ตอน disable */
        input[type="text"]:disabled {
            cursor: not-allowed;
        }
        /* input ตอน enable */
        input[type="text"]:not(:disabled) {
            opacity: 1;
        }

    /* สไตล์สำหรับ input */
    input[type="number"] {
        transition: opacity 0.3s ease, background-color 0.3s ease; /* แอนิเมชันนุ่มนวล */
    }
        /* input ตอน disable */
        input[type="number"]:disabled {
            cursor: not-allowed;
        }
        /* input ตอน enable */
        input[type="number"]:not(:disabled) {
            opacity: 1;
        }

    #table_leave th,
    #table_leave td {
        border-left: none !important;
        border-right: none !important;
        padding: 8px 10px !important; /* ทำให้เซลล์สูงขึ้น */
        vertical-align: middle !important; /* สำรองถ้า Bootstrap ไม่ทำงาน */
    }

    table.dataTable tbody td {
        border-left: none !important;
        border-right: none !important;
        border-top: none !important; /* ถ้าต้องการลบเส้นแนวนอนด้วย ให้ uncomment */
    }

    /* สำหรับ header ถ้าต้องการลบแนวตั้ง */
    table.dataTable thead th {
        border-left: none !important;
        border-right: none !important;
    }

    /* ลบเส้นล่างของ footer ถ้ามี */
    table.dataTable tfoot th {
        border-bottom: 1px solid #111; /* เก็บเส้นแนวนอนไว้ */
    }

    .freeze-pane {
        overflow: auto;
        height: 600px;
        position: relative;
    }

    .freeze-head {
        position: sticky;
        top: 0;
        background: #EEE;
        z-index: 10;
        box-shadow: 0 2px 2px rgba(0,0,0,0.3);

    }

    .freeze-left {
        position: sticky;
        left: 0;
        width: 200px;
        background: white;
        box-shadow: 0 2px 2px rgba(0,0,0,0.3);
        z-index: 5;
    }

    .freeze-corner {
        z-index: 15 !important;
    }

    .half-left {
        background: linear-gradient(90deg, green 50%, lightgrey 50%);
        border: none;
        position: relative;
        overflow: hidden;
    }
        .half-left::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            width: 1px;
            height: 100%;
            background: lightgrey;
            transform: translateX(-50%);
        }

    .half-right {
        background: linear-gradient(90deg, lightgrey 50%, green 50%);
        border: none;
        position: relative;
        overflow: hidden;
    }
        .half-right::before {
            content: '';ช
            position: absolute;
            left: 50%;
            top: 0;
            width: 1px;
            height: 100%;
            background: lightgrey;
            transform: translateX(-50%);
        }

    .leave-warning {
        background-color: #f8d7da !important;
        border-left: 4px solid #dc3545 !important;
    }

    .leave-info {
        background-color: #d1ecf1 !important;
        border-left: 4px solid #17a2b8 !important;
    }


    .color-grid-container {
        width: 50px;
        height: 50px;
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

        .color-grid-container > div {
            position: absolute;
            width: 50%;
            height: 50%;
            transition: transform 0.3s ease;
        }

            .color-grid-container > div:hover {
                transform: scale(1.1);
                z-index: 10;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            }

    .color-top-left {
        top: 0;
        left: 0;
        background: yellow;
    }

    .color-top-right {
        top: 0;
        right: 0;
        background: blue;
    }

    .color-bottom-left {
        bottom: 0;
        left: 0;
        background: red;
    }

    .color-bottom-right {
        bottom: 0;
        right: 0;
        background: lightgrey;
    }
</style>

<div class="row" style="row-gap:1px">
    <div class="col-12">
        <span class="kanit-bold" style="font-size:24px;color:dimgrey">สถานะการลาพนักงาน</span>
        <hr style="border:solid;color:gray;border-width:1px" />

        <div class="color-grid-container" style="border-radius:50%;">
            <div class="color-top-left"></div>
            <div class="color-top-right"></div>
            <div class="color-bottom-left"></div>
            <div class="color-bottom-right"></div>
        </div>
    </div>
    <div class="col-xl-12 col-md-12 col-sm-12">
        <div class="card card-dark">
            <div class="card-body" style="height:700px; overflow-y:auto">
                <form>
                    <div class="form-group">
                        <!-- Filter Monthly-->
                        <div class="mb-3 d-flex justify-content-center">
                            <input type="button" id="prevMonth" class="btn btn-outline-secondary me-2" value="<" />
                            <input type="month" id="monthPicker" class="form-control kanit-regular" style="width:200px; display:inline-block;">
                            <input type="button" id="nextMonth" class="btn btn-outline-secondary ms-2" value=">" />
                        </div>

                        <!-- Status Data Employees -->
                        <div class="freeze-pane">
                            <table id="table_leave" class="table table-sm compact table-bordered table-hover text-center w-100">
                                <thead class="kanit-light" style="background-color:#E8E8E8">
                                    <tr id="headerRow">
                                        <th rowspan="2" class="kanit-bold freeze-head freeze-left freeze-corner" style="vertical-align:middle;background-color:#E8E8E8;">รายชื่อ</th>
                                    </tr>
                                    <tr id="dateRow">
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<partial name="ModalSpin" />
@section Scripts
{
    <script type="text/javascript">
        let table_leave = null;
        let leaves = [];
        let index_today = 0;
        let is_this_month = true;
        let day_of_month = 0;
        var table;
        $(document).ready(async function () {
            refreshTable();
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            index_today = now.getDate();
            
            const currentYearMonth = year + '-' + String(month).padStart(2, '0');
            $('#monthPicker').val(currentYearMonth);
            day_of_month = new Date(year, month, 0).getDate();

            generateDateHeaders();
        });
        function generateDateHeaders() {
            $('#SpinModal').modal();
            const monthPicker = $('#monthPicker');
            //const headerRow = $('#headerRow');
            const dateRow = $('#dateRow');
            const [year, month] = monthPicker.val().split('-');
            const daysInMonth = new Date(year, month, 0).getDate();

            dateRow.empty();

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dayName = date.toLocaleDateString('th-TH', { weekday: 'short' });
                dateRow.append(`<th class="kanit-bold freeze-head" style="min-width:40px;">${day}<br><small>${dayName}</small></th>`);
            }
            $('#SpinModal').modal('hide');
        }
        $('#monthPicker').on('change', function () {
            if (is_this_month) {
                is_this_month = false;
            } else {
                is_this_month = true;
            }
            
            generateDateHeaders();
            refreshTable();
        });

        $('#prevMonth').on('click', function () {
            let monthPicker = new Date($('#monthPicker').val());
            monthPicker.setMonth(monthPicker.getMonth() - 1);
            const currentYearMonth = monthPicker.getFullYear() + '-' + String(monthPicker.getMonth() + 1).padStart(2, '0');
            $('#monthPicker').val(currentYearMonth);
            generateDateHeaders();
            refreshTable();
        });

        $('#nextMonth').on('click', function () {
            let monthPicker = new Date($('#monthPicker').val());
            monthPicker.setMonth(monthPicker.getMonth() + 1);
            const currentYearMonth = monthPicker.getFullYear() + '-' + String(monthPicker.getMonth() + 1).padStart(2, '0');
            $('#monthPicker').val(currentYearMonth);
            generateDateHeaders();
            refreshTable();
        });

        function refreshTable() {
            
                init();
            
        }
        function init() {
            $(document).ready(async function () {
                if (table !== undefined) {
                    table.destroy();
                }
                table = $('#table_leave').DataTable({
                    ajax: {
                        type: "GET",
                        url: '@Url.Action("GetData", "ManagementLeave")',
                        contentType: 'application/x-www-form-urlencoded',
                        dataSrc: ''
                    },
                    
                    columnDefs: (() => {
                        const defs = [];
                        for (let i = 0; i <= day_of_month; i++) {
                            const colors = ['primary', 'success', 'danger'];
                            const classes = ['half-left', 'half-right', ''];

                            if (i == 0) {
                                defs.push({
                                    targets: i,
                                    render: function (data, type, row) {
                                        var imgSrc = '/images/default-avatar.png';
                                        if (row.img) {
                                            imgSrc = 'data:image/jpeg;base64,' + row.img;
                                        }
                                        return `
                                           <div class="row align-items-center" style="width:300px">
                                             <div class="col-2 d-flex justify-content-center">
                                                    <img src="${imgSrc}"
                                                        class="rounded-circle me-2"
                                                        style="width: 32px; height: 32px; object-fit: cover;"
                                                        alt="${row.name}" />
                                             </div>
                                                <div class="col-10 d-flex justify-content-start">
                                                    <div style="color:#444">
                                                        <span class="kanit-regular d-block text-start fw-bold d-flex justify-content-start">${row.name}</span>
                                                        <span class="kanit-light d-block text-start text-muted small d-flex justify-content-start">พนักงานทั่วไป</span>
                                                    </div>
                                                </div>
                                           </div>`;
                                    }
                                });
                            }                             
                            else {
                                defs.push({
                                    targets: i,
                                    render: function (data, type, row) {
                                        return `
                                            <input type="button" 
                                                   class="kanit-light btn btn-${colors[0]} ${classes[0]}" 
                                                   style="width:30px;height:30px;border-radius:15px"/>
                                        `;
                                    }
                                });
                            }
                        }
                        return defs;
                    })(),
                    rowCallback: function (row, data, index) {
                        if (is_this_month) {
                            $('td', row).each(function (colIndex) {
                                if (colIndex === index_today) {
                                    $('td:eq(' + index_today + ')', row).addClass('leave-info');
                                }
                            });
                        }
                    },
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/th.json'
                    },
                    "info": false,
                    "paging": false,
                    "searching": false,
                    "ordering": false,
                    fixedColumns: {
                        left: 1
                    },
                    scrollX: false,
                    scrollCollapse: true,
                    fixedHeader: true,
                    destroy: true,
                });
            });
        }
    </script>
}

