@model WebENG.Models.UserModel;
@{
    ViewData["Title"] = "Leave Management";

}
<link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

<style>

    table.dataTable.table-sm thead th,
    table.dataTable.table-sm tbody td {
        padding: 0.5rem 0.75rem !important;
    }

    #table_complete_wrapper .DTFC_LeftWrapper table.dataTable,
    #table_complete_wrapper .dataTables_scrollBody table.dataTable {
        width: 100% !important;
        margin: 0 !important;
    }

    #table_complete_wrapper .dataTables_scrollHead table {
        margin-bottom: 0 !important;
    }

    #table_complete_wrapper .dataTables_scrollBody table {
        border-top: none !important;
    }

    .custom-control-input:not(:checked) ~ .custom-control-label::before {
        background-color: lightgray;
        border-color: lightgray;
    }

    .custom-control-input:checked ~ .custom-control-label::before {
        background-color: green;
        border-color: green;
    }

    .kanit-thin {
        font-family: "Kanit", sans-serif !important;
        font-weight: 100 !important;
        font-style: normal !important;
    }

    .kanit-extralight {
        font-family: "Kanit", sans-serif;
        font-weight: 200;
        font-style: normal;
    }

    .kanit-light {
        font-family: "Kanit", sans-serif !important;
        font-weight: 300 !important;
        font-style: normal !important;
    }

    .kanit-regular {
        font-family: "Kanit", sans-serif;
        font-weight: 400;
        font-style: normal;
    }

    .kanit-medium {
        font-family: "Kanit", sans-serif;
        font-weight: 500;
        font-style: normal;
    }

    .kanit-semibold {
        font-family: "Kanit", sans-serif;
        font-weight: 600;
        font-style: normal;
    }

    .kanit-bold {
        font-family: "Kanit", sans-serif;
        font-weight: 700;
        font-style: normal;
    }

    .kanit-extrabold {
        font-family: "Kanit", sans-serif;
        font-weight: 800;
        font-style: normal;
    }

    .kanit-black {
        font-family: "Kanit", sans-serif;
        font-weight: 900;
        font-style: normal;
    }

    .kanit-thin-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 100;
        font-style: italic;
    }

    .kanit-extralight-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 200;
        font-style: italic;
    }

    .kanit-light-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 300;
        font-style: italic;
    }

    .kanit-regular-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 400;
        font-style: italic;
    }

    .kanit-medium-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 500;
        font-style: italic;
    }

    .kanit-semibold-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 600;
        font-style: italic;
    }

    .kanit-bold-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 700;
        font-style: italic;
    }

    .kanit-extrabold-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 800;
        font-style: italic;
    }

    .kanit-black-italic {
        font-family: "Kanit", sans-serif;
        font-weight: 900;
        font-style: italic;
    }

    /* input[type="checkbox"] {
        transition: all 0.3s ease;
        transform: scale(1.5);
    }

        input[type="checkbox"]:checked {
            transform: scale(1.75);
            background-color: #32a852;
        } */
    /* Checkbox สไตล์องค์กร - เล็ก เรียบ เท่ */
    input[type="checkbox"] {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        border: 2px solid #adb5bd;
        border-radius: 5px;
        outline: none;
        cursor: pointer;
        background-color: #fff;
        transition: all 0.25s ease;
        transform: scale(1); /* ไม่ขยายพื้นฐาน */
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

        input[type="checkbox"]:hover {
            border-color: #007bff;
            box-shadow: 0 0 6px rgba(0,123,255,0.25);
        }

        /* เมื่อติ๊กถูก */
        input[type="checkbox"]:checked {
            background-color: #28a745;
            border-color: #28a745;
            transform: scale(1.1);
        }

            /* ติ๊กขาว */
            input[type="checkbox"]:checked::after {
                content: '';
                position: absolute;
                top: 3px;
                left: 6px;
                width: 4px;
                height: 8px;
                border: solid white;
                border-width: 0 2.5px 2.5px 0;
                transform: rotate(45deg);
            }

        /* สถานะกึ่งเลือก (indeterminate) */
        input[type="checkbox"]:indeterminate {
            background-color: #007bff;
            border-color: #007bff;
            transform: scale(1.1);
        }

            input[type="checkbox"]:indeterminate::after {
                content: '';
                position: absolute;
                top: 7px;
                left: 3px;
                width: 10px;
                height: 2px;
                background: white;
                border-radius: 1px;
            }

    /* หัวตาราง Select All - ใหญ่กว่า checkbox ปกตินิดเดียว (ดูเด่นแต่ไม่ล้น) */
    #selectAllApprove {
        width: 20px !important;
        height: 20px !important;
        transform: scale(1.05);
    }

        #selectAllApprove:checked,
        #selectAllApprove:indeterminate {
            transform: scale(1.15) !important;
        }
    /*//////////////*/


    /* สไตล์สำหรับ input */
    input[type="text"] {
        transition: opacity 0.3s ease, background-color 0.3s ease; /* แอนิเมชันนุ่มนวล */
    }
        /* input ตอน disable */
        input[type="text"]:disabled {
            cursor: not-allowed;
        }
        /* input ตอน enable */
        input[type="text"]:not(:disabled) {
            opacity: 1;
        }
    /* สไตล์สำหรับ input */
    input[type="number"] {
        transition: opacity 0.3s ease, background-color 0.3s ease; /* แอนิเมชันนุ่มนวล */
    }
        /* input ตอน disable */
        input[type="number"]:disabled {
            cursor: not-allowed;
        }
        /* input ตอน enable */
        input[type="number"]:not(:disabled) {
            opacity: 1;
        }


    /* สไตล์สำหรับรายการไฟล์ */
    .file-item {
        padding: 10px 15px;
        border-bottom: 1px solid #dee2e6;
        transition: opacity 0.3s ease; /* ใช้ transition แทน keyframes */
    }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background: #f8f9fa;
        }

    .file-link {
        color: #007bff;
        text-decoration: none;
        transition: color 0.3s ease;
    }

        .file-link:hover {
            color: #0056b3;
            text-decoration: underline;
        }

    /* Responsive design */
    .responsive-file-item {
        flex-direction: column;
        align-items: flex-start;
    }

    .responsive-select-file-btn {
        width: 100%;
    }

    /* สไตล์สำหรับส่วนผู้อนุมัติ */
    .approver-item {
        padding: 12px 15px;
        border-bottom: 1px solid #dee2e6;
        transition: all 0.3s ease; /* เหมือน dropzone */
    }

        .approver-item:last-child {
            border-bottom: none;
        }

        .approver-item:hover {
            background: #f8f9fa; /* Highlight เหมือน file-item */
            transform: translateY(-2px); /* ยกขึ้นเล็กน้อย */
        }

        .approver-item i {
            font-size: 16px;
        }

    #approver-note {
        font-size: 14px;
        background: #e9ecef;
        border-bottom: 1px solid #dee2e6;
    }

    .badge {
        font-size: 14px;
        padding: 8px 12px;
        border-radius: 12px; /* ขอบโค้งทันสมัย */
    }

    .badge-warning {
        background-color: #ffc107; /* รออนุมัติ = เหลือง */
    }

    .badge-success {
        background-color: #28a745; /* อนุมัติ = เขียว */
    }

    .badge-danger {
        background-color: #dc3545; /* ไม่อนุมัติ = แดง */
    }

    /* ตารางมีมุมโค้งมน */
    .table {
        border-collapse: separate !important;
        border-spacing: 0;
       /* table-layout: fixed !important;*/ /*สำคัญที่สุด!*/
        overflow-x: auto;
        width: 100%; /*บังคับให้เต็ม container*/
        border-radius: 12px !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

        /* เส้นขอบแนวนอนใน tbody */
        .table tbody td {
            border-top: 1px solid #dee2e6 !important;
            border-bottom: none !important;
        }

        /* ลบเส้นแนวตั้งทั้งหมด (ถ้าต้องการ) */
        .table th,
        .table td {
            border-left: none !important;
            border-right: none !important;
            padding: 10px 10px !important; /* ทำให้เซลล์สูงขึ้น */
            vertical-align: middle !important;  /*สำรองถ้า Bootstrap ไม่ทำงาน */
        }

        .table th {
            padding: 3px 10px !important;  /*ทำให้เซลล์สูงขึ้น */
        }

        .table td {
            padding: 10px 10px !important;  /*ทำให้เซลล์สูงขึ้น */
        }

        /* Badge โค้งมน */
        .table .badge {
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: 500;
        }

    .clickable-row {
        cursor: pointer !important;
        transition: all 0.2s ease !important;
    }

        .clickable-row:hover {
            background-color: #f2faff !important;
            transform: translateY(-1px) !important; /* เพิ่มยกขึ้นเล็กน้อย */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }

    /* Card พนักงาน */
    .modern-card {
        transition: all 0.3s ease;
        border: none !important;
    }

        .modern-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(28, 70, 152, 0.15) !important;
        }

    /* ป้องกัน dropdown ถูกตัด */
    .dropdown-search {
        position: relative;
        z-index: 1050;
    }

    /* 1. header sticky เท่านั้นที่เป็นสีเทา */
    .freeze-head.freeze-left-1,
    .freeze-head.freeze-left-2,
    .freeze-head.freeze-left-3 {
        background: #EEE !important;
        z-index: 15 !important;
    }

    /* 2. body sticky (td) เป็นสีขาว */
    /*.table tbody td.freeze-left-1,
    .table tbody td.freeze-left-2,
    .table tbody td.freeze-left-3 {
        background: white !important;
        z-index: 10;
    }*/

    /* 3. ป้องกันทับกันตอนเลื่อน */
    .freeze-head {
        background: #EEE !important;
        z-index: 10;
    }

    /* sticky styles */
    .freeze-pane {
        overflow: auto;
        height: auto;
        max-height: 500px;
        width: 100%;
        position: relative;
        display: block;
    }

    .freeze-head {
        position: sticky;
        top: 0;
        background: #EEE;
        z-index: 10;
        box-shadow: 0 2px 2px rgba(0,0,0,0.3);
    }

    /* คอลัมน์ 1: ติดซ้ายสุด */
    .freeze-left-1 {
        position: sticky;
        left: 0;
        background: #EEE;
        z-index: 10;
    }

    /* คอลัมน์ 2: ติดถัดจากคอลัมน์ 1 */
    .freeze-left-2 {
        position: sticky;
        left: 60px; /* ปรับตามความกว้างจริงของคอลัมน์ 1 */
        background: #EEE;
        z-index: 9;
    }

    /* คอลัมน์ 3: ติดถัดจากคอลัมน์ 2 */
    .freeze-left-3 {
        position: sticky;
        left: 160px; /* 60 + 100 = 160px (ปรับตามจริง) */
        background: #EEE;
        z-index: 8;
        box-shadow: 2px 0 5px -2px rgba(0,0,0,0.3);
    }

    .freeze-corner {
        z-index: 15 !important;
    }

    #modal_leave .modal-body {
        height: auto !important; /* ลบ 600px ออก */
        max-height: 70vh;
    }

    .modal-footer {
        position: sticky;
        bottom: 0;
        background: white;
        z-index: 1;
        box-shadow: 0 -5px 10px rgba(0,0,0,0.05);
    }

    .modal:nth-of-type(even) {
        z-index: 1060 !important;
    }

    .modal-backdrop.show:nth-of-type(even) {
        z-index: 1055 !important;
        opacity: 0.5 !important;
    }

    .modal-blur-scale .modal-dialog {
        transform: scale(0.93) !important;
        filter: blur(1.5px) !important;
        transition: all 0.35s ease !important;
    }

    .modal-blur-scale {
        pointer-events: none !important;
    }

    /* ปุ่มทันสมัย 2025 - ใช้ชุดแรก แต่ไม่มี shimmer */
    .modern-btn {
        font-weight: 600;
        letter-spacing: 1px;
        text-transform: uppercase;
        border-radius: 12px !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        min-width: 110px;
    }

        /* Hover สวย ยกขึ้น + เงาเข้มขึ้น (ไม่มีแสงวิ่งแล้ว) */
        .modern-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.18);
        }

    /* ปุ่มปฏิเสธ */
    .btn-outline-danger.modern-btn {
        color: #e74c3c;
        border: 2px solid #e74c3c;
        background: transparent;
    }

        .btn-outline-danger.modern-btn:hover {
            background: #e74c3c;
            color: white;
            box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3);
        }

    /* ปุ่มส่งกลับ */
    .btn-outline-warning.modern-btn {
        color: #f39c12;
        border: 2px solid #f39c12;
        background: transparent;
    }

        .btn-outline-warning.modern-btn:hover {
            background: #f39c12;
            color: white;
            box-shadow: 0 10px 25px rgba(243, 156, 18, 0.3);
        }

    /* ปุ่มอนุมัติ */
    .btn-success.modern-btn {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
        border: 2px solid #27ae60;
        color: white;
        background-size: 200% 200%;
        transition: all 0.4s ease;
    }

        .btn-success.modern-btn:hover {
            background-position: 100% 100%;
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.4);
            transform: translateY(-3px);
        }
    /* ไอคอนยังคงสวยงาม */
    .modern-btn i {
        margin-right: 6px;
        font-size: 1.1em;
    }
</style>

<div class="row" style="row-gap:15px">

    <!-- HEADER -->
    <div class="col-12" style="padding:20px">
        <span class="kanit-bold d-flex justify-content-center " style="font-size:30px; color:#1C4698; text-align:center;">
            อนุมัติ & ตรวจสอบการลาพนักงาน
        </span>
    </div>

    <!-- Table Leave Approve -->
    <div class="col-xl-12 col-md-12 col-sm-12">
        <div class="card card-dark" style="border-top-right-radius:20px; border-top-left-radius:20px;">

            <div class="card-header  d-flex justify-content-between align-items-center"
                 style="background: linear-gradient(90deg, rgba(33, 120, 190, 1) 0%, rgba(40, 71, 95, 1) 100%);
                 border-radius: 20px 20px 0 0;">

                <!-- หัวข้อ รายการรออนุมัติ พร้อม Badge แจ้งเตือน -->
                <h4 class="kanit-medium mb-0 text-white d-flex align-items-center"
                    style="letter-spacing: 1px; font-size: 22px; gap: 12px;">
                    รายการรออนุมัติ
                    <span id="request_amount" class="d-inline-flex align-items-center justify-content-center rounded-circle bg-warning kanit-bold"
                          style="width: 30px; height: 30px; font-size: 18px; text-align:center; box-shadow: 0 0px 12px rgba(0, 0, 0, 0.2);">
                        0
                    </span>
                </h4>
            </div>

            <div style="overflow-x:auto">
                <table id="table_approve" class="table table-sm table-hover text-center mb-0 w-100">
                    <thead style="font-size:18px; color:#555">
                        <tr class="kanit-light align-middle" style="vertical-align:middle">
                            <th style="width:80px;"> ลำดับ</th>
                            <th style="width:80px;">รหัสพนักงาน</th>
                            <th style="width:180px;">ชื่อ-สกุล</th>
                            <th>วันที่ยื่นลา</th>
                            <th>วันที่ลา</th>
                            <th>เวลาที่ลา</th>
                            <th>ระยะเวลา (วัน)</th>
                            <th>ประเภทการลา</th>
                            <th>รายละเอียด</th>
                            <th style="width:70px;">แนบไฟล์</th>
                            <th style="width:50px;">
                                <div class="form-check form-check-inline mb-1">
                                    <input class="form-check-input" type="checkbox" id="selectAllApprove">
                                    <label class="form-check-label" for="selectAllApprove"></label>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <!-- Footer Button : ปฏิเสธ, ส่งกลับ, อนุมัติ-->
            <div class="modal-footer d-flex">
                <div class="container d-flex justify-content-end">
                    <div class="col-xl-12 col-md-12 col-sm-12 d-flex justify-content-end">
                        <div class="row">
                            <div class="col-4">
                                <button id="btn_all_approve_leave" data-target="#modal_approve" class="btn modern-btn btn-success kanit-medium" style=" border-radius:8px; width:120px; letter-spacing:2px;" hidden>
                                    อนุมัติ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Table Leave Log -->
    <div class="col-xl-12 col-md-12 col-sm-12">
        <div class="card card-dark" style="border-top-right-radius:20px; border-top-left-radius:20px;">

            <div class="card-header  d-flex justify-content-between align-items-center"
                 style="background: linear-gradient(90deg, rgba(33, 120, 190, 1) 0%, rgba(40, 71, 95, 1) 100%);
                 border-radius: 20px 20px 0 0;">

                <!-- HEADER -->
                <h4 class="kanit-medium mb-0 text-white d-flex align-items-center"
                    style="letter-spacing: 1px; font-size: 22px; gap: 12px;">
                    ประวัติการลา
                </h4>
            </div>

            <div style="overflow-x:auto">
                <table id="table_complete" class="table table-sm table-hover text-center mb-0 w-100">
                    <thead style="font-size:18px; color:#555">
                        <tr class="kanit-light align-middle">
                            <th style="width:80px;"> ลำดับ</th>
                            <th style="width:80px;">รหัสพนักงาน</th>
                            <th style="width:180px;">ชื่อ-สกุล</th>
                            <th>วันที่ยื่นลา</th>
                            <th>วันที่ลา</th>
                            <th>เวลาที่ลา</th>
                            <th>ระยะเวลา (วัน)</th>
                            <th>ประเภทการลา</th>
                            <th>รายละเอียด</th>
                            <th>แนบไฟล์</th>
                            <th>สถานะ</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modal_leave" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal modal-dialog modal-dialog-centered modal-md" role="document">
            <div class="modal-content kanit-regular">
                <div class="modal-header" style="background: linear-gradient(90deg, rgba(33, 120, 190, 1) 0%, rgba(40, 71, 95, 1) 100%); color: white; border-bottom: none">
                    <h5 class="modal-title" id="modal_leave_title">อนุมัติการลา</h5>
                    <h5 class="modal-title">(</h5>
                    <h5 class="modal-title" id="modal_request_id"></h5>
                    <h5 class="modal-title">)</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" style="color: white;">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style=" color:#555555; overflow-y:auto">
                    <form>
                        <!-- ข้อมูลการลา -->
                        <div class="col-12">
                            <div class="form-group">
                                <label class="kanit-medium" style="letter-spacing:1px; font-size:18px">
                                    <i class="fas fa-info-circle mr-2"></i>ข้อมูลการลา
                                </label>
                                <div style="padding-left:20px;">
                                    <div>
                                        <label id="leave_description" class="col-12 kanit-light" style="white-space:pre-line"></label>
                                    </div>
                                </div>
                                <hr />
                            </div>
                        </div>

                        <!-- ส่วนแสดงรายการไฟล์ -->
                        <div class="col-12 mb-4" id="div_fileList" hidden>
                            <label class="kanit-medium" style="letter-spacing:1px; font-size:18px">
                                <i class="fas fa-paperclip mr-2"></i>เอกสารที่แนบ
                            </label>
                            <div class="card" style="border-radius: 10px; ">
                                <div class="list-group" id="fileListContainer">

                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <label class="kanit-medium" style="letter-spacing:1px; font-size:18px; color:#555;">
                                <i class="fas fa-history mr-2"></i>ไทม์ไลน์การอนุมัติ
                            </label>
                            <div id="div_history_approved" class="timeline-container" style="position: relative; padding-left: 35px;">
                            </div>
                        </div>
                    </form>
                </div>
                <!-- Footer Button : ปฏิเสธ, ส่งกลับ, อนุมัติ-->
                <div class="modal-footer d-flex">
                    <div class="input-group mb-2">
                        <textarea id="leave_reason" type="text" class="form-control" placeholder="เหตุผลการดำเนินการ" rows="2"></textarea>
                    </div>
                    <div class="col-xl-12 col-md-12 col-sm-12 d-flex justify-content-end">
                        <div class="row kanit-medium">
                            <div class="ml-2">
                                <button id="btn_reject_leave"
                                        class="btn modern-btn btn-outline-danger"
                                        style="border-radius:8px; width:90px; letter-spacing:1px" onclick="RejectClicked()">
                                    ปฏิเสธ
                                </button>
                            </div>
                            <div class="ml-2">
                                <button id="btn_resubmit_leave"
                                        class="btn modern-btn btn-outline-warning"
                                        style="border-radius:8px; width:90px; letter-spacing:1px" onclick="ResubmitClicked()">
                                    ส่งกลับ
                                </button>
                            </div>
                            <div class="ml-2">
                                <button id="btn_approve_leave"
                                        class="btn modern-btn btn-success"
                                        style="border-radius:8px; width:90px; letter-spacing:1px" onclick="ApproveClicked()">
                                    อนุมัติ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ====================== Modal อนุมัติ ====================== -->
</div>

<div class="modal fade" id="modal_approves" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content shadow-lg border-0" style="border-radius: 12px;">
            <div class="modal-header bg-success text-white" style="border-radius: 12px 12px 0 0;">
                <h5 class="modal-title kanit-semibold">
                    <i class="fas fa-check-circle mr-2"></i> ยืนยันการอนุมัติ
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="fas fa-check fa-4x text-success mb-3"></i>
                <p class="kanit-medium mb-0" style="font-size: 1.1rem;">
                    คุณต้องการ <strong class="text-success">อนุมัติ</strong> คำขอลานี้หรือไม่?
                    <br><small class="text-muted">เมื่ออนุมัติแล้ว ระบบจะแจ้งเตือนพนักงานทันที</small>
                </p>
            </div>
            <div class="modal-footer justify-content-center border-0 pt-0">
                <button type="button" class="btn btn-secondary kanit-medium px-4" data-dismiss="modal" style="border-radius: 8px;">
                    ยกเลิก
                </button>
                <button type="button" id="confirm_approves" class="btn btn-success kanit-medium px-4" style="border-radius: 8px;">
                    <i class="fas fa-check mr-1"></i> อนุมัติคำขอ
                </button>
            </div>
        </div>
    </div>
</div>
<!------------------------------------------------------------------------------------------->
<!-- ====================== Modal ปฏิเสธ ====================== -->
<div class="modal fade" id="modal_reject" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content shadow-lg border-0" style="border-radius: 12px;">
            <div class="modal-header bg-danger text-white" style="border-radius: 12px 12px 0 0;">
                <h5 class="modal-title kanit-semibold">
                    <i class="fas fa-times-circle mr-2"></i> ยืนยันการปฏิเสธคำขอ
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="fas fa-exclamation-triangle fa-4x text-danger mb-3"></i>
                <p class="kanit-medium mb-0" style="font-size: 1.1rem;">
                    คุณแน่ใจหรือไม่ว่าต้องการ <strong class="text-danger">ปฏิเสธ</strong> คำขอลานี้?
                </p>
                <br><small class="text-muted">เมื่อปฏิเสธแล้วจะไม่สามารถย้อนกลับได้</small>
                </p>
            </div>
            <div class="modal-footer justify-content-center border-0 pt-0">
                <button type="button" class="btn btn-secondary kanit-medium px-4" data-dismiss="modal" style="border-radius: 8px;">
                    ยกเลิก
                </button>
                <button type="button" id="confirm_reject" class="btn btn-danger kanit-medium px-4" style="border-radius: 8px;">
                    <i class="fas fa-check mr-1"></i> ยืนยันปฏิเสธ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ====================== Modal ส่งกลับ ====================== -->
<div class="modal fade" id="modal_resubmit" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content shadow-lg border-0" style="border-radius: 12px;">
            <div class="modal-header bg-warning text-dark" style="border-radius: 12px 12px 0 0;">
                <h5 class="modal-title kanit-semibold">
                    <i class="fas fa-undo-alt mr-2"></i> ส่งกลับเพื่อแก้ไข
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="fas fa-reply fa-4x text-warning mb-3"></i>
                <p class="kanit-medium mb-3" style="font-size: 1.1rem;">
                    คุณต้องการ <strong class="text-warning">ส่งกลับ</strong> คำขอนี้ให้พนักงานแก้ไขหรือไม่?
                </p>
            </div>
            <div class="modal-footer justify-content-center border-0 pt-0">
                <button type="button" class="btn btn-secondary kanit-medium px-4" data-dismiss="modal" style="border-radius: 8px;">
                    ยกเลิก
                </button>
                <button type="button" id="confirm_resubmit" class="btn btn-warning text-dark kanit-medium px-4" style="border-radius: 8px;">
                    <i class="fas fa-paper-plane mr-1"></i> ส่งกลับ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ====================== Modal อนุมัติ ====================== -->
<div class="modal fade" id="modal_approve" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content shadow-lg border-0" style="border-radius: 12px;">
            <div class="modal-header bg-success text-white" style="border-radius: 12px 12px 0 0;">
                <h5 class="modal-title kanit-semibold">
                    <i class="fas fa-check-circle mr-2"></i> ยืนยันการอนุมัติ
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body text-center py-4">
                <i class="fas fa-check fa-4x text-success mb-3"></i>
                <p class="kanit-medium mb-0" style="font-size: 1.1rem;">
                    คุณต้องการ <strong class="text-success">อนุมัติ</strong> คำขอลานี้หรือไม่?
                    <br><small class="text-muted">เมื่ออนุมัติแล้ว ระบบจะแจ้งเตือนพนักงานทันที</small>
                </p>
            </div>
            <div class="modal-footer justify-content-center border-0 pt-0">
                <button type="button" class="btn btn-secondary kanit-medium px-4" data-dismiss="modal" style="border-radius: 8px;">
                    ยกเลิก
                </button>
                <button type="button" id="confirm_approve" class="btn btn-success kanit-medium px-4" style="border-radius: 8px;">
                    <i class="fas fa-check mr-1"></i> อนุมัติคำขอ
                </button>
            </div>
        </div>
    </div>
</div>


<!------------------------------------------------------------------------------------------------>
<div class="modal fade" id="modal_leave_history" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md" role="document">
        <div class="modal-content kanit-regular">
            <div class="modal-header" style="background: linear-gradient(90deg, rgba(33, 120, 190, 1) 0%, rgba(40, 71, 95, 1) 100%); color: white; border-bottom: none">
                <h5 class="modal-title" id="modal_history_leave_title">ประวัติการลา</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="color: white;">&times;</span>
                </button>
            </div>
            <div class="modal-body" style=" color:#555555; overflow-y:auto">
                <form>
                    <!-- ข้อมูลการลา -->
                    <div class="col-12">
                        <div class="form-group">
                            <label class="kanit-medium" style="letter-spacing:1px; font-size:18px">
                                <i class="fas fa-info-circle mr-2"></i>ข้อมูลการลา
                            </label>
                            <div style="padding-left:20px;">
                                <div>
                                    <label id="leave_history_description" class="col-12 kanit-light" style="white-space:pre-line"></label>
                                </div>
                            </div>
                            <hr />
                        </div>
                    </div>

                    <!-- ส่วนแสดงรายการไฟล์ -->
                    <div class="col-12 mb-4" id="div_history_fileList" hidden>
                        <label class="kanit-medium" style="letter-spacing:1px; font-size:18px">
                            <i class="fas fa-paperclip mr-2"></i>เอกสารที่แนบ
                        </label>
                        <div class="card" style="border-radius: 10px; ">
                            <div class="list-group" id="fileListContainerHistory">

                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <label class="kanit-medium" style="letter-spacing:1px; font-size:18px; color:#555;">
                            <i class="fas fa-history mr-2"></i>ไทม์ไลน์การอนุมัติ
                        </label>

                        <div id="div_history_request" class="timeline-container" style="position: relative; padding-left: 35px;">
                        </div>
                    </div>
                </form>
            </div>
            <!-- Footer Button : ปฏิเสธ, ส่งกลับ, อนุมัติ-->
            <div class="modal-footer d-flex">
                <div class="input-group mb-2">
                    <label id="leave_history_reason" type="text" class="kanit-light"></label>
                </div>
                <div class="col-xl-12 col-md-12 col-sm-12 d-flex justify-content-end">
                    <div class="row kanit-medium">
                        <div class="ml-2">
                            <button class="btn modern-btn btn-danger"
                                    style="border-radius:8px; width:90px; letter-spacing:1px" data-dismiss="modal">
                                ปิด
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<partial name="ModalSpin" />

@section Scripts
{
    <script type="text/javascript">
        let table_approve= null;
        let requests_pending = [];
        let requests_no_pending = [];

        const request_status = [
            { status_en: "Created", status: { status_th: "สร้าง", class: "secondary" } },
            { status_en: "Pending", status: { status_th: "อนุมัติ", class: "warning" } },
            { status_en: "Resubmit", status: { status_th: "ส่งใหม่", class: "secondary" } },
            { status_en: "Canceled", status: { status_th: "ยกเลิก", class: "danger" } },
            { status_en: "Approved", status: { status_th: "อนุมัติ", class: "success" } },
            { status_en: "Rejected", status: { status_th: "ไม่อนุมัติ", class: "danger" } },
            { status_en: "Returned", status: { status_th: "ตีกลับ", class: "info" } },
            { status_en: "Completed", status: { status_th: "สำเร็จ", class: "success" } },
        ];

        $(document).ready(function () {
            GetRequests();

            $('#modal_reject, #modal_resubmit, #modal_approve').on('show.bs.modal', function () {
                var $modal = $(this);

                $modal.css('z-index', 1060);
                setTimeout(function () {
                    $('.modal-backdrop').last().css('z-index', 1059);
                }, 50);
                setTimeout(function () {
                    var $dialog = $modal.find('.modal-dialog');
                    $dialog.css({
                        'left': '-5px',
                        'top': '',
                        'transform': 'none'
                    });
                }, 150);
            });
        });

        function ResubmitClicked() {
            let reason = $('#leave_reason').val().trim();
            if (reason !== "" && reason !== null) {
                $('#modal_resubmit').modal({
                    backdrop: 'static',
                    keyboard: false
                });
            } else {
                alert("กรุณาใส่เหตุผลการส่งกลับ");
            }
        }

        function RejectClicked() {
            let reason = $('#leave_reason').val().trim();
            if (reason !== "" && reason !== null) {
                $('#modal_reject').modal({
                    backdrop: 'static',
                    keyboard: false
                });
            } else {
                alert("กรุณาใส่เหตุผลการส่งปฏิเสธ");
            }
        }

        function ApproveClicked() {
            $('#modal_approve').modal({
                backdrop: 'static',
                keyboard: false
            });
        }

        async function GetRequests() {
            let useds = [];
            await $.ajax({
                type: "GET",
                url: '@Url.Action("GetRequest", "ManagementLeave")',
                contentType: 'application/x-www-form-urlencoded',
                data: {},
                success: function (response) {
                    requests_pending = response.pending;
                    requests_no_pending = response.no_pending;

                    let completes = requests_no_pending;
                    let uncompletes = requests_pending;

                    renderRequestHistory(uncompletes);
                    renderRequestCompleteHistory(completes);
                    $('#request_amount').text(uncompletes.length);
                },
                error: function () {
                    console.error('โหลดสิทธิ์ลาล้มเหลว');
                }
            });
            return useds;
        }

        function timeToMinutes(timeStr) {
            const timePart = timeStr.split('.').pop();
            const [h, m] = timePart.split(':').map(Number);
            return h * 60 + m;
        }

        function renderRequestHistory(uncompletes) {
            const $tbody = $('#table_approve tbody').empty();
            uncompletes.forEach((row, index) => {
                let request_date = `${new Date(row.request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.request_date).toLocaleDateString('en-GB')}`;
                let start_request_date = "";
                if (row.is_full_day) {
                    if (row.amount_leave_day > 1) {
                        start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')} - ${new Date(row.end_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.end_request_date).toLocaleDateString('en-GB')}`;
                    } else {
                        start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')}`;
                    }
                } else {
                    start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')}`;
                }

                let duration = 0;
                let start_request_time = "08:30";
                let end_request_time = "17:30";
                if (row.is_full_day) {
                    duration = row.amount_leave_day;
                } else {
                    let start = timeToMinutes(row.start_request_time);
                    let end = timeToMinutes(row.end_request_time);
                    let diff = end - start;
                    duration = (diff / 480).toFixed(2);
                    if (duration > 0.3 && duration < 0.6) {
                        duration = 0.50;
                    }
                    if (duration >= 0.65 && duration <= 0.9) {
                        duration = 0.75;
                    }

                    start_request_time = row.start_request_time.split('.')[1].substring(0, 5);
                    end_request_time = row.end_request_time.split('.')[1].substring(0, 5);
                }

                //Check Box Create For Check Attach File 

                let class_path_file = `<td></td>`;
                let class_check = `<td></td>`;
                if (row.attachment_required) {
                    if (row.is_full_day) { /*hidden*/
                        if (parseFloat(row.amount_leave_day) >= parseFloat(row.attachment_threshold_days)) {
                            if (row.path_file === "" || row.path_file === null) {
                                class_path_file = `<td class="clickable-col"><i class="fas fa-minus-circle" style="color: red; font-size:22px"></i></td>`;
                                class_check = `<td>
                            <div class="form-check form-check-inline mb-1">
                                <input class="form-check-input approve-checkbox" type="checkbox">
                                <label class="form-check-label"></label>
                            </div>
                        </td>`;
                            } else {
                                class_path_file = `<td class="clickable-col"><i class="fas fa-check-circle" style="color: deepskyblue; font-size:22px"></i></td>`;
                                class_check = `<td>
                            <div class="form-check form-check-inline mb-1">
                                <input class="form-check-input approve-checkbox" type="checkbox">
                                <label class="form-check-label"></label>
                            </div>
                        </td>`;
                            }
                        } else {
                            class_path_file = `<td></i></td>`;
                            class_check = `<td>
                            <div class="form-check form-check-inline mb-1">
                                <input class="form-check-input approve-checkbox" type="checkbox">
                                <label class="form-check-label"></label>
                            </div>
                        </td>`;
                        }
                    } else {

                        if (parseFloat(row.amount_leave_hour) / 8.0 >= parseFloat(row.attachment_threshold_days)) {
                            if (row.path_file === "" || row.path_file === null) {/*hidden*/
                                class_path_file = `<td class="clickable-col"><i class="fas fa-minus-circle" style="color: red; font-size:22px"></i></td>`;
                                class_check = `<td>
                            <div class="form-check form-check-inline mb-1">
                                <input class="form-check-input approve-checkbox" type="checkbox" > 
                                <label class="form-check-label"></label>
                            </div>
                        </td>`;
                            } else {
                                class_path_file = `<td class="clickable-col"><i class="fas fa-check-circle" style="color: deepskyblue; font-size:22px"></i></td>`;
                                class_check = `<td>
                            <div class="form-check form-check-inline mb-1">
                                <input class="form-check-input approve-checkbox" type="checkbox">
                                <label class="form-check-label"></label>
                            </div>
                        </td>`;
                            }
                        } else {
                            class_path_file = `<td></i></td>`;
                            class_check = `<td>
                            <div class="form-check form-check-inline mb-1">
                                <input class="form-check-input approve-checkbox" type="checkbox">
                                <label class="form-check-label"></label>
                            </div>
                        </td>`;
                        }
                    }
                } else {
                    class_path_file = `<td></td>`;
                    class_check = `<td>
                            <div class="form-check form-check-inline mb-1">
                                <input class="form-check-input approve-checkbox" type="checkbox">
                                <label class="form-check-label"></label>
                            </div>
                        </td>`;
                }

                ////Check Box Create For manager , Director Only
                //const canApprove = row.is_two_step_approve
                //    ? row.level_step < 2
                //    : row.level_step < 1;

                //let hasRequiredAttachment = true;
                //if (row.attachment_required && parseFloat(row.amount_leave_day) >= parseFloat(row.attachment_threshold_days)) {
                //    hasRequiredAttachment = !!(row.path_file && row.path_file !== "");
                //}

                //if (row.attachment_required && parseFloat(row.amount_leave_day) >= parseFloat(row.attachment_threshold_days)) {
                //    class_path_file = hasRequiredAttachment
                //        ? `<td class="clickable-col"><i class="fas fa-check-circle" style="color: deepskyblue; font-size:22px"></i></td>`
                //        : `<td class="clickable-col"><i class="fas fa-minus-circle" style="color: red; font-size:22px"></i></td>`;
                //} else {
                //    class_path_file = `<td></td>`;
                //}

                //const checkboxHidden = (canApprove && hasRequiredAttachment) || row.is_two_step_approve ? '' : 'hidden';

                //class_check = `<td>
                //    <div class="form-check form-check-inline mb-1">
                //        <input class="form-check-input approve-checkbox" type="checkbox" ${checkboxHidden}>
                //        <label class="form-check-label"></label>
                //    </div>
                //</td>`;

                ////

                const tr = $(`
                    <tr class="clickable-row kanit-regular" style="color:#555; font-size: 16px;"
                        data-toggle="modal" data-target="#modal_leave"
                        data-id="${row.request_id}" data-emp-id="${row.emp_id}"
                        data-request-date="${request_date}" data-leave-date="${start_request_date}"
                        data-time="${row.start_request_time}" data-duration="${duration}"
                        data-type="${row.leave_name_th}" data-note="${row.description}" data-status="${row.status_request}">
                        <td class="clickable-col">${index + 1}</td>
                        <td class="clickable-col">${row.emp_id}</td>
                        <td class="clickable-col">${row.emp_name_th}</td>
                        <td class="clickable-col">${request_date}</td>
                        <td class="clickable-col">${start_request_date}</td>
                        <td class="clickable-col">${start_request_time}-${end_request_time}</td>
                        <td class="clickable-col">${duration}</td>
                        <td class="clickable-col">${row.leave_name_th}</td>
                        <td class="clickable-col">${row.description}</td>
                        ${class_path_file}
                        ${class_check}
                    </tr>
                `);

                tr.on('click', '.clickable-col', async function (e) {
                    e.stopPropagation();
                    const $row = $(this).closest('tr');
                    $('#modal_leave').modal('show');
                    const requestId = $row.attr('data-id');
                    const request = uncompletes.filter(f => f.request_id === requestId).map(m => m)[0];
                    let description = "";
                    if (request.is_full_day) {
                        if (request.amount_leave_day > 1) {
                            description = `ชื่อ : ${request.emp_name_th}
                                         ประเภทการลา : ${request.leave_name_th}
                                         ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')} -  ${new Date(request.end_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.end_request_date).toLocaleDateString('en-GB')} (${request.amount_leave_day} วัน)
                                         รายละเอียด : ${request.description}`;
                        } else {
                            description = `ชื่อ : ${request.emp_name_th}
                                         ประเภทการลา : ${request.leave_name_th}
                                         ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')} (${request.amount_leave_day} วัน)
                                         รายละเอียด : ${request.description}`;
                        }
                    } else {
                        description = `ชื่อ : ${request.emp_name_th}
                                         ประเภทการลา : ${request.leave_name_th}
                                         ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')}
                                         เวลา : ${request.start_request_time.split('.')[1].substring(0, 5)} - ${request.end_request_time.split('.')[1].substring(0, 5)}
                                         รายละเอียด : ${request.description}`;
                    }
                    $('#leave_description').text(description);

                    //Check Attach File List
                    if (request.attachment_required) {
                        let year = new Date(request.start_request_date).getFullYear();
                        if (request.is_full_day) {
                            if (parseFloat(request.amount_leave_day) >= parseFloat(request.attachment_threshold_days)) {
                                GetFiles(request.leave_type_id, request.request_id, year);
                                $('#div_fileList').attr('hidden', false);
                            }
                        } else {

                            if (parseFloat(request.amount_leave_hour) / 8.0 >= parseFloat(request.attachment_threshold_days)) {
                                GetFiles(request.leave_type_id, request.request_id, year);
                                $('#div_fileList').attr('hidden', false);
                            }
                        }

                    } else {
                        $('#div_fileList').attr('hidden', true);
                        //$('#btn_approve_leave').attr('disabled', false);
                    }

                    // Request Title
                    $('#modal_request_id').text(request.request_id);

                    // Get Request Log
                    let requests_log = await GetRequestLog(request.emp_id, request.request_id);
                    GenerateHistoryApproveLog(requests_log);
                });

                tr.on('click', function (e) {
                    if (!$(e.target).hasClass('clickable-col') &&
                        !$(e.target).closest('.clickable-col').length) {
                        e.stopPropagation();
                    }
                });
                $tbody.append(tr);
            });
        }

        function GenerateHistoryApproveLog(requests_log) {
            var html = '';
            let position = "";
            let next_position = "";
            let status = "";
            for (var i = 0; i < requests_log.length; i++) {
                if (requests_log[i].level > 0) {
                    if (requests_log[i].is_two_step_approve) {
                        if (requests_log[i].current_level === 1) {
                            position = "Manager";
                        }
                        if (requests_log[i].current_level === 2) {
                            position = "Director";
                        }
                    } else {
                        status = request_status.filter(f => f.status_en === requests_log[i].status).map(m => m.status)[0];
                        if (requests_log[i].current_level === 1) {
                            position = "Manager";
                        }
                    }

                } else {
                    if (requests_log[i].is_two_step_approve) {
                        status = request_status.filter(f => f.status_en === requests_log[i].status).map(m => m.status)[0];
                        if (requests_log[i].current_level === 0) {
                            position = "Operation";
                        }
                        if (requests_log[i].current_level === 1) {
                            position = "Manager";
                        }
                        if (requests_log[i].current_level === 2) {
                            position = "Director";
                        }
                    } else {
                        status = request_status.filter(f => f.status_en === requests_log[i].status).map(m => m.status)[0];
                        if (requests_log[i].current_level === 0) {
                            position = "Operation";
                        }
                        if (requests_log[i].current_level === 1) {
                            position = "Manager";
                        }
                    }
                }

                if (requests_log[i].status !== "Rejected" && requests_log[i].status !== "Canceled" && requests_log[i].status !== "Returned") {
                    html += `<div class="d-flex align-items-center mb-3 text-success">
                                <i class="fas fa-check-circle fa-lg mr-3"></i>
                                <div class="flex-grow-1">
                                    <span class="kanit-medium" style="color:#555">${requests_log[i].emp_name}</span>
                                    <span class="text-muted kanit-regular">(${position})</span>
                                    <div>
                                        <span class="text-success kanit-medium">${status.status_th}</span>
                                        <span class="text-muted kanit-medium"> • ${new Date(requests_log[i].date).toLocaleDateString('en-GB')} ${requests_log[i].date.split('T')[1]}</span>
                                    </div>
                                </div>
                                <hr />
                            </div>`;
                } else {
                    html += `<div class="d-flex align-items-center mb-3 text-danger">
                                <i class="fas fa-minus-circle fa-lg mr-3"></i>
                                <div class="flex-grow-1">
                                    <span class="kanit-medium" style="color:#555">${requests_log[i].emp_name}</span>
                                    <span class="text-muted kanit-regular">(${position})</span>
                                    <div>
                                        <span class="text-danger kanit-medium">${status.status_th}</span>
                                        <span class="text-muted kanit-medium"> • ${new Date(requests_log[i].date).toLocaleDateString('en-GB')} ${requests_log[i].date.split('T')[1]}</span>
                                    </div>
                                </div>
                                <hr />
                            </div>`;
                }

                if (requests_log[i].next_level === 0) {
                    next_position = "Operation";
                }
                if (requests_log[i].next_level === 1) {
                    next_position = "Manager";
                }
                if (requests_log[i].next_level === 2) {
                    next_position = "Director";
                }
                if (requests_log[i].next_level === 3) {
                    next_position = "Checker";
                }
            }
            html += `<div class="d-flex align-items-center mb-3 text-warning">
                                <i class="fas fa-clock fa-lg mr-3"></i>
                                <div class="flex-grow-1">
                                    <span class="kanit-medium" style="color:#555"> </span>
                                    <span class="text-muted kanit-regular">(${next_position})</span>
                                    <div>
                                        <span class="text-muted kanit-medium">รอตรวจสอบ</span>
                                    </div>
                                </div>
                            </div>`;
            $('#div_history_approved').empty();
            $('#div_history_approved').append(html);

        }
        function GenerateHistoryRequestLog(requests_log) {
            var html = '';
            let position = "";
            let status = "";
            for (var i = 0; i < requests_log.length; i++) {

                status = request_status.filter(f => f.status_en === requests_log[i].status).map(m => m.status)[0];
                if (requests_log[i].current_level === 0) {
                    position = "Operation";
                }
                if (requests_log[i].current_level === 1) {
                    position = "Manager";
                }
                if (requests_log[i].current_level === 2) {
                    position = "Director";
                }
                if (requests_log[i].current_level === 3) {
                    position = "Checker";
                }


                if (requests_log[i].status !== "Rejected" && requests_log[i].status !== "Canceled" && requests_log[i].status !== "Returned") {
                    html += `<div class="d-flex align-items-center mb-3 text-success">
                                <i class="fas fa-check-circle fa-lg mr-3"></i>
                                <div class="flex-grow-1">
                                    <span class="kanit-medium" style="color:#555">${requests_log[i].emp_name}</span>
                                    <span class="text-muted kanit-regular">(${position})</span>
                                    <div>
                                        <span class="text-success kanit-medium">${status.status_th}</span>
                                        <span class="text-muted kanit-medium"> • ${new Date(requests_log[i].date).toLocaleDateString('en-GB')} ${requests_log[i].date.split('T')[1]}</span>
                                    </div>
                                </div>
                                <hr />
                            </div>`;
                } else {
                    html += `<div class="d-flex align-items-center mb-3 text-danger">
                                <i class="fas fa-minus-circle fa-lg mr-3"></i>
                                <div class="flex-grow-1">
                                    <span class="kanit-medium" style="color:#555">${requests_log[i].emp_name}</span>
                                    <span class="text-muted kanit-regular">(${position})</span>
                                    <div>
                                        <span class="text-danger kanit-medium">${status.status_th}</span>
                                        <span class="text-muted kanit-medium"> • ${new Date(requests_log[i].date).toLocaleDateString('en-GB')} ${requests_log[i].date.split('T')[1]}</span>
                                    </div>
                                </div>
                                <hr />
                            </div>`;
                }

            }
            $('#div_history_request').empty();
            $('#div_history_request').append(html);

        }

        let completeTable;

        function renderRequestCompleteHistory(completes) {
            const data = completes.map((row, index) => {
                let request_date = `${new Date(row.request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.request_date).toLocaleDateString('en-GB')}`;
                let start_request_date = "";
                if (row.is_full_day) {
                    if (row.amount_leave_day > 1) {
                        start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')} - ${new Date(row.end_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.end_request_date).toLocaleDateString('en-GB')}`;
                    } else {
                        start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')}`;
                    }
                } else {
                    start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')}`;
                }

                let duration = 0;
                let start_request_time = "08:30";
                let end_request_time = "17:30";
                if (row.is_full_day) {
                    duration = row.amount_leave_day;
                } else {
                    let start = timeToMinutes(row.start_request_time);
                    let end = timeToMinutes(row.end_request_time);
                    let diff = end - start;
                    duration = (diff / 480).toFixed(2);
                    if (duration > 0.3 && duration < 0.6) {
                        duration = 0.50;
                    }
                    if (duration >= 0.65 && duration <= 0.9) {
                        duration = 0.75;
                    }

                    start_request_time = row.start_request_time.split('.')[1].substring(0, 5);
                    end_request_time = row.end_request_time.split('.')[1].substring(0, 5);
                }

                let class_path_file = `<td></td>`;
                if (row.attachment_required) {
                    if (parseFloat(row.amount_leave_day) >= parseFloat(row.attachment_threshold_days)) {
                        if (row.path_file === "" || row.path_file === null) {
                            class_path_file = `<td class="clickable-col"><i class="fas fa-minus-circle" style="color: red; font-size:22px"></i></td>`;
                        } else {
                            class_path_file = `<td class="clickable-col"><i class="fas fa-check-circle" style="color: deepskyblue; font-size:22px"></i></td>`;
                        }
                    }
                }

                let time_range = start_request_time + "-" + end_request_time;
                let status = request_status.filter(f => f.status_en === row.status_request).map(m => m.status)[0];

                return {
                    no: index + 1,
                    emp_id: row.emp_id,
                    name: row.emp_name_th || "-",
                    request_date,
                    start_request_date,
                    time_range,
                    duration,
                    type: row.leave_name_th,
                    note: row.description,
                    attachment: class_path_file,
                    status: `<span class="badge badge-${status.class} p-2 kanit-light" style="font-size:16px; border-radius:20px;">${status.status_th}</span>`,
                    raw: row 
                };
            });

            if (completeTable) {
                completeTable.destroy();
            }

            completeTable = $('#table_complete').DataTable({
                destroy: true,
                data: data,
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/2.1.8/i18n/th.json'
                },
                pageLength: 25,
                scrollX: true,
                fixedHeader: true,
                //fixedColumns: {
                //    left: 3
                //},
                order: [[4, 'desc']],
                columnDefs: [
                    //{ className: "freeze-left-1", targets: 0 },
                    //{ className: "freeze-left-2", targets: 1 },
                    //{ className: "freeze-left-3", targets: 2 }
                ],
                columns: [
                    { data: 'no' },
                    { data: 'emp_id' },
                    { data: 'name' },
                    { data: 'request_date' },
                    { data: 'start_request_date' },
                    { data: 'time_range' },
                    { data: 'duration' },
                    { data: 'type' },
                    { data: 'note' },
                    { data: 'attachment', orderable: false },
                    { data: 'status'}
                ],
                createdRow: function (row, data, dataIndex) {
                    $(row)
                        .addClass('clickable-row kanit-regular')
                        .css({ color: '#555', fontSize: '16px', cursor: 'pointer' })
                        .attr({
                            'data-toggle': 'modal',
                            'data-target': '#modal_leave_history',
                            'data-id': data.raw.request_id,
                            'data-emp-id': data.raw.emp_id,
                            'data-request-date': data.request_date,
                            'data-leave-date': data.leave_date,
                            'data-time': data.raw.start_request_time,
                            'data-duration': data.duration,
                            'data-type': data.raw.leave_name_th,
                            'data-note': data.raw.description || '',
                            'data-status': data.raw.status_request
                        });

                    $(row).on('click', async function (e) {
                        e.stopPropagation();
                        const request = data.raw;

                        $('#modal_leave_history').modal('show');

                        let description = "";
                        if (request.is_full_day) {
                            if (request.amount_leave_day > 1) {
                                description = `ชื่อ : ${request.emp_name_th}
                                ประเภทการลา : ${request.leave_name_th}
                                ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')} - ${new Date(request.end_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.end_request_date).toLocaleDateString('en-GB')} (${request.amount_leave_day} วัน)
                                รายละเอียด : ${request.description || '-'}`;
                                                            } else {
                                                                description = `ชื่อ : ${request.emp_name_th}
                                ประเภทการลา : ${request.leave_name_th}
                                ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')} (${request.amount_leave_day} วัน)
                                รายละเอียด : ${request.description || '-'}`;
                                                            }
                                                        } else {
                                                            const st = request.start_request_time.split('.')[1]?.substring(0, 5);
                                                            const et = request.end_request_time.split('.')[1]?.substring(0, 5);
                                                            description = `ชื่อ : ${request.emp_name_th}
                                ประเภทการลา : ${request.leave_name_th}
                                ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')}
                                เวลา : ${st} - ${et}
                                รายละเอียด : ${request.description || '-'}`;
                        }

                        $('#leave_history_description').text(description);

                        // แนบไฟล์
                        if (request.attachment_required) {
                            const year = new Date(request.start_request_date).getFullYear();
                            GetHistoryFiles(request.leave_type_id, request.request_id, year);
                            $('#div_history_fileList').removeAttr('hidden');
                        } else {
                            $('#div_history_fileList').attr('hidden', true);
                        }

                        // เหตุผลการอนุมัติ/ปฏิเสธ
                        if (request.comment) {
                            $('#leave_history_reason').text(request.comment).removeAttr('hidden');
                        } else {
                            $('#leave_history_reason').attr('hidden', true).text('');
                        }

                        // Log
                        const logs = await GetRequestLog(request.emp_id, request.request_id);
                        GenerateHistoryRequestLog(logs);
                    });
                },
                paging: false,
                searching: false,
                info: false,

            });
        };

        function renderRequestCompleteHistoryOLD(completes) {
            const $tbody = $('#table_complete tbody').empty();
            completes.forEach((row, index) => {
                let request_date = `${new Date(row.request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.request_date).toLocaleDateString('en-GB')}`;
                let start_request_date = "";
                if (row.is_full_day) {
                    if (row.amount_leave_day > 1) {
                        start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')} - ${new Date(row.end_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.end_request_date).toLocaleDateString('en-GB')}`;
                    } else {
                        start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')}`;
                    }
                } else {
                    start_request_date = `${new Date(row.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(row.start_request_date).toLocaleDateString('en-GB')}`;
                }

                let duration = 0;
                let start_request_time = "08:30";
                let end_request_time = "17:30";
                if (row.is_full_day) {
                    duration = row.amount_leave_day;
                } else {
                    let start = timeToMinutes(row.start_request_time);
                    let end = timeToMinutes(row.end_request_time);
                    let diff = end - start;
                    duration = (diff / 480).toFixed(2);
                    if (duration > 0.3 && duration < 0.6) {
                        duration = 0.50;
                    }
                    if (duration >= 0.65 && duration <= 0.9) {
                        duration = 0.75;
                    }

                    start_request_time = row.start_request_time.split('.')[1].substring(0, 5);
                    end_request_time = row.end_request_time.split('.')[1].substring(0, 5);
                }

                let class_path_file = `<td></td>`;
                if (row.attachment_required) {
                    if (parseFloat(row.amount_leave_day) >= parseFloat(row.attachment_threshold_days)) {
                        if (row.path_file === "" || row.path_file === null) {
                            class_path_file = `<td class="clickable-col"><i class="fas fa-minus-circle" style="color: red; font-size:22px"></i></td>`;
                        } else {
                            class_path_file = `<td class="clickable-col"><i class="fas fa-check-circle" style="color: green; font-size:22px"></i></td>`;
                        }
                    }
                }
                let status = request_status.filter(f => f.status_en === row.status_request).map(m => m.status)[0];
                const tr = $(`
                    <tr class="clickable-row kanit-regular" style="color:#555; font-size: 16px;"
                        data-toggle="modal" data-target="#modal_leave_history"
                        data-id="${row.request_id}" data-emp-id="${row.emp_id}"
                        data-request-date="${request_date}" data-leave-date="${start_request_date}"
                        data-time="${row.start_request_time}" data-duration="${duration}"
                        data-type="${row.leave_name_th}" data-note="${row.description}" data-status="${row.status_request}">
                        <td class="clickable-col">${index + 1}</td>
                        <td class="clickable-col">${row.emp_id}</td>
                        <td class="clickable-col">${row.emp_name_th}</td>
                        <td class="clickable-col">${request_date}</td>
                        <td class="clickable-col">${start_request_date}</td>
                        <td class="clickable-col">${start_request_time}-${end_request_time}</td>
                        <td class="clickable-col">${duration}</td>
                        <td class="clickable-col">${row.leave_name_th}</td>
                        <td class="clickable-col">${row.description}</td>
                        ${class_path_file}
                        <td class="clickable-col"><span class="badge badge-${status.class} p-2 kanit-light" style="font-size:16px; border-radius:20px;">${status.status_th}</span></td>
                    </tr>
                `);

                tr.on('click', async function (e) {
                    e.stopPropagation();
                    const $row = $(this).closest('tr');
                    $('#modal_leave_history').modal('show');
                    const requestId = $row.attr('data-id');
                    const request = completes.filter(f => f.request_id === requestId).map(m => m)[0];
                    let description = "";
                    if (request.is_full_day) {
                        if (request.amount_leave_day > 1) {
                            description = `ชื่อ : ${request.emp_name_th}
                                         ประเภทการลา : ${request.leave_name_th}
                                         ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')} -  ${new Date(request.end_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.end_request_date).toLocaleDateString('en-GB')} (${request.amount_leave_day} วัน)
                                         รายละเอียด : ${request.description}`;
                        } else {
                            description = `ชื่อ : ${request.emp_name_th}
                                         ประเภทการลา : ${request.leave_name_th}
                                         ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')} (${request.amount_leave_day} วัน)
                                         รายละเอียด : ${request.description}`;
                        }
                    } else {
                        description = `ชื่อ : ${request.emp_name_th}
                                         ประเภทการลา : ${request.leave_name_th}
                                         ลาวันที่ : ${new Date(request.start_request_date).toLocaleDateString('th-TH', { weekday: 'short' })} ${new Date(request.start_request_date).toLocaleDateString('en-GB')}
                                         เวลา : ${request.start_request_time.split('.')[1].substring(0, 5)} - ${request.end_request_time.split('.')[1].substring(0, 5)}
                                         รายละเอียด : ${request.description}`;
                    }
                    $('#leave_history_description').text(description);

                    //Check Attach File List
                    if (request.attachment_required) {
                        let year = new Date(request.start_request_date).getFullYear();
                        GetHistoryFiles(request.leave_type_id, request.request_id, year);
                        $('#div_history_fileList').attr('hidden', false);

                    } else {
                        $('#div_history_fileList').attr('hidden', true);
                    }


                    //Reason
                    if (request.comment === "" || request.comment === null) {
                        $('#leave_history_reason').attr('hidden', true);
                        $('#leave_history_reason').text("");
                    } else {
                        $('#leave_history_reason').text(request.comment);
                        $('#leave_history_reason').attr('hidden', false);
                    }

                    // Get Request Log
                    let requests_log = await GetRequestLog(request.emp_id, request.request_id);
                    GenerateHistoryRequestLog(requests_log);
                });
                $tbody.append(tr);
            });
        }

        $('#selectAllApprove').on('change', function () {
            const isChecked = this.checked;
            const $checkboxes = $('#table_approve tbody .approve-checkbox');

            $checkboxes.not(':hidden').prop('checked', isChecked).trigger('change');

            $('#table_approve tbody tr').each(function () {
                const $cb = $(this).find('.approve-checkbox');
                if (!$cb.is(':hidden')) {
                    $(this).toggleClass('table-primary', isChecked);
                }
            });
        });

        $('#confirm_approve').on('click', async function () {
            $('#confirm_approve').attr('disabled', true);
            $('#SpinModal').modal();
            let comment = $('#leave_reason').val().trim();
            let request_id = $('#modal_request_id').text();

            await $.ajax({
                type: "POST",
                url: '@Url.Action("Approved", "ManagementLeave")',
	            contentType: 'application/x-www-form-urlencoded',
                data: {
                    request_id, comment
                },
                success: function (response) {
                    if (response === "Success") {
                        
                    } else {
                        alert(response);
                    }
                }
            });
            location.reload();
            $('#SpinModal').modal('hide');
            $('#confirm_approve').attr('disabled', false);
        });

        $('#confirm_resubmit').on('click', async function () {
            $('#confirm_resubmit').attr('disabled', true);
            $('#SpinModal').modal();
            let comment = $('#leave_reason').val().trim();
            let request_id = $('#modal_request_id').text();

            await $.ajax({
                type: "POST",
                url: '@Url.Action("Returned", "ManagementLeave")',
	            contentType: 'application/x-www-form-urlencoded',
                data: {
                    request_id, comment
                },
                success: function (response) {
                    if (response === "Success") {
                    } else {
                        alert(response);
                    }
                }
            });
            location.reload();
            $('#SpinModal').modal('hide');
            $('#confirm_resubmit').attr('disabled', false);
        });

        $('#confirm_reject').on('click', async function () {
            $('#confirm_reject').attr('disabled', true);
            $('#SpinModal').modal();
            let comment = $('#leave_reason').val().trim();
            let request_id = $('#modal_request_id').text();

            await $.ajax({
                type: "POST",
                url: '@Url.Action("Rejected", "ManagementLeave")',
	            contentType: 'application/x-www-form-urlencoded',
                data: {
                    request_id, comment
                },
                success: function (response) {
                    if (response === "Success") {
                    } else {
                        alert(response);
                    }
                }
            });
            location.reload();
            $('#SpinModal').modal('hide');
            $('#confirm_reject').attr('disabled', false);
        });

        $('#confirm_approves').on('click', async function () {
            $('#confirm_approves').attr('disabled', true);
            $('#SpinModal').modal();
            const selected = getSelectedRows();
            let selects = selected.map(m => m.request_id);
            await $.ajax({
                type: "POST",
                url: '@Url.Action("Approveds", "ManagementLeave")',
                contentType: 'application/x-www-form-urlencoded',
                data: {
                    selects
                },
                success: function (response) {
                    if (response === "Success") {
                    } else {
                        alert(response);
                    }
                }
            });
            location.reload();
            $('#SpinModal').modal('hide');
            $('#confirm_approves').attr('disabled', false);
        });

        $(document).on('change', '#table_approve tbody .approve-checkbox', function () {
            const totalVisible = $('#table_approve tbody .approve-checkbox').not(':hidden').length;
            const totalChecked = $('#table_approve tbody .approve-checkbox:checked').not(':hidden').length;

            const allChecked = totalVisible > 0 && totalChecked === totalVisible;
            const someChecked = totalChecked > 0 && totalChecked < totalVisible;

            const $selectAll = $('#selectAllApprove');
            $selectAll.prop({
                checked: allChecked,
                indeterminate: someChecked
            });

            $(this).closest('tr').toggleClass('table-primary', this.checked);
            if (allChecked || someChecked) {
                $('#btn_all_approve_leave').attr('hidden', false);
            } else {
                $('#btn_all_approve_leave').attr('hidden', true);
            }
        });

        function getSelectedRows() {
            const selectedRows = [];

            $('#table_approve tbody .approve-checkbox:checked').each(function () {
                const $row = $(this).closest('tr');
                const rowData = {
                    request_id: $row.data('id'),
                    emp_id: $row.data('emp-id'),
                    emp_name_th: $row.find('td.freeze-left-3').text().trim(),
                    request_date: $row.data('request-date'),
                    leave_date: $row.data('leave-date'),
                    leave_time: $row.find('td:eq(5)').text().trim(),
                    duration_days: parseFloat($row.find('td:eq(6)').text()),
                    leave_type: $row.data('type'),
                    description: $row.data('note'),
                    status: $row.data('status'),
                };

                selectedRows.push(rowData);
            });

            return selectedRows;
        }

        $('#btn_all_approve_leave').on('click', function () {
            $('#modal_approves').modal();

        });

        async function GetFiles(leave_type_id, request_id, year) {
            await $.ajax({
                type: "GET",
                url: '@Url.Action("GetFiles", "ManagementLeave")',
	            contentType: 'application/x-www-form-urlencoded',
                data: {
                    leave_type_id, request_id, year
                },
                success: function (response) {
                    const myFiles = response;
                    loadExistingFiles(myFiles);
                }
            });
        }

        async function GetHistoryFiles(leave_type_id, request_id, year) {
            await $.ajax({
                type: "GET",
                url: '@Url.Action("GetFiles", "ManagementLeave")',
	            contentType: 'application/x-www-form-urlencoded',
                data: {
                    leave_type_id, request_id, year
                },
                success: function (response) {
                    const myFiles = response;
                    loadExistingHistoryFiles(myFiles);
                }
            });
        }

        async function GetRequestLog(emp_id, request_id) {
            let requests_log = [];
            await $.ajax({
                type: "GET",
                url: '@Url.Action("GetRequestLog", "ManagementLeave")',
	            contentType: 'application/x-www-form-urlencoded',
                data: {
                     emp_id,request_id
                },
                success: function (response) {
                     requests_log = response;
                }
            });
            return requests_log;
        }


        function createFileItem(fileName, fileType, fileUrl) {
            const fileItem = document.createElement('div');
            fileItem.className = 'list-group-item d-flex align-items-center file-item added';

            const viewLink = document.createElement('a');
            viewLink.href = fileUrl;
            viewLink.target = '_blank';
            viewLink.rel = 'noopener';
            viewLink.className = 'text-decoration-none flex-grow-1 d-flex align-items-center';
            viewLink.style.cursor = 'pointer';

            const iconClass = fileType.includes('pdf')
                ? 'fas fa-file-pdf text-danger'
                : 'fas fa-file-image text-primary';

            viewLink.innerHTML = `
        <i class="${iconClass} mr-2"></i>
        <span class="kanit-regular text-dark">${fileName}</span>
    `;
            fileItem.appendChild(viewLink);

            return fileItem;
        }

        function loadExistingFiles(fileArray) {
            $('#fileListContainer').empty();
            const container = document.getElementById('fileListContainer');
           
            if (fileArray.length > 0) {
                fileArray.forEach(file => {
                    let fileType = file.type;
                    if (!fileType && file.filename) {
                        const ext = file.filename.split('.').pop().toLowerCase();
                        if (['pdf'].includes(ext)) fileType = 'pdf';
                        else if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) fileType = 'image';
                        else if (['doc', 'docx'].includes(ext)) fileType = 'word';
                        else if (['xls', 'xlsx'].includes(ext)) fileType = 'excel';
                        else fileType = 'file';
                    }

                    const item = createFileItem(file.filename, fileType, file.path);
                    container.appendChild(item);
                    //$('#btn_approve_leave').attr('disabled', false);
                });
            } else {
                container.appendChild(createTextMessage("ไม่มีเอกสาร", "text-danger"));
                //$('#btn_approve_leave').attr('disabled', true);
            }
        }

        function loadExistingHistoryFiles(fileArray) {
            $('#fileListContainerHistory').empty();
            const container = document.getElementById('fileListContainerHistory');

            if (fileArray.length > 0) {
                fileArray.forEach(file => {
                    let fileType = file.type;
                    if (!fileType && file.filename) {
                        const ext = file.filename.split('.').pop().toLowerCase();
                        if (['pdf'].includes(ext)) fileType = 'pdf';
                        else if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) fileType = 'image';
                        else if (['doc', 'docx'].includes(ext)) fileType = 'word';
                        else if (['xls', 'xlsx'].includes(ext)) fileType = 'excel';
                        else fileType = 'file';
                    }

                    const item = createFileItem(file.filename, fileType, file.path);
                    container.appendChild(item);
                });
            } else {
                container.appendChild(createTextMessage("ไม่มีเอกสาร", "text-danger"));
            }
        }

        function createTextMessage(message, textColor = "text-danger") {
            const div = document.createElement('div');
            div.className = `list-group-item text-center py-4 ${textColor}`;
            div.style.fontSize = '1.1rem';
            div.innerHTML = `
        <i class="fas fa-info-circle fa-2x mb-3 opacity-50"></i><br>
        <span class="kanit-regular">${message}</span>
    `;
            return div;
        }

    </script>
}
